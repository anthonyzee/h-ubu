<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Jul 2, 2013
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nanoko :: h-ubu</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

          
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="stylesheet" type="text/css" href="./css/site.css"/>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="stylesheet" type="text/css" href="./css/font-awesome.css"/>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript">var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-1518442-11']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();</script>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript">$(document).ready(function () {
                $("pre code").parent().addClass("prettyprint");
                prettyPrint();
                });</script>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="shortcut icon" href="favicon.png"/>
          
    <meta name="Date-Revision-yyyymmdd" content="20130702" />
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/nanoko-project/h-ubu">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 100;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="#" id="bannerLeft">
                                                                                                <img src="h-ubu-small.png"  alt="h-ubu - JavaScript Componentization"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-07-02</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.0.1-SNAPSHOT</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3>H-UBU</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="motivations.html" title="Motivations and Concepts">Motivations and Concepts</a>
            </li>
                  <li class="none">
            <strong>Quickstart</strong>
          </li>
                  <li class="none">
                          <a href="external-resources.html" title="Resources">Resources</a>
            </li>
          </ul>
                        <h3>User Guide</h3>
                  <ul>
                  <li class="none">
                          <a href="creating-and-registering-components.html" title="Creating and Registering Components">Creating and Registering Components</a>
            </li>
                  <li class="none">
                          <a href="providing-services.html" title="Providing Services">Providing Services</a>
            </li>
                  <li class="none">
                          <a href="requiring-services.html" title="Requiring Services">Requiring Services</a>
            </li>
                  <li class="none">
                          <a href="direct-injection.html" title="Direct Injection">Direct Injection</a>
            </li>
                  <li class="none">
                          <a href="receiving-and-sending-events.html" title="Receiving and Sending Events">Receiving and Sending Events</a>
            </li>
                  <li class="none">
                          <a href="testing-components.html" title="Testing Components">Testing Components</a>
            </li>
                  <li class="none">
                          <a href="FAQ.html" title="FAQ">FAQ</a>
            </li>
          </ul>
                        <h3>Advanced Topics</h3>
                  <ul>
                  <li class="none">
                          <a href="using-requirejs.html" title="Using require.js">Using require.js</a>
            </li>
                  <li class="none">
                          <a href="using-nodejs.html" title="Using h-ubu in node.js">Using h-ubu in node.js</a>
            </li>
                  <li class="none">
                          <a href="contract.html" title="Contract and Conformity">Contract and Conformity</a>
            </li>
                  <li class="none">
                          <a href="service-orientation.html" title="Service-Orientation">Service-Orientation</a>
            </li>
                  <li class="none">
                          <a href="developper-guide.html" title="Developer Guide">Developer Guide</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                            <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="http://nanoko-project.github.com/h-ubu" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="https://github.com/nanoko-project/h-ubu" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Quickstart</h1><p>This page explains how to get started with H-Ubu in 10 minutes. Let&rsquo;s imagine a really simple <a href="quickstart/demo.html">application</a>:</p><p><img src="demo.png"  alt="A simple demo"/></p><p><strong>Note:</strong> To see the demo, use either Chrome, Safari or Firefox with Firebug.</p><p>So, nothing complex: two buttons, a message. The traditional JavaScript way to do that would be to write all the JavaScript in the HTML file, which is exactly what H-Ubu will <strong>NOT</strong> do. Why not? Because that would mean:</p>
<ul>
  <li>dealing with HTML DOM modifications (and directly accessing the HTML DOM)</li>
  <li>dealing with Ajax calls and server communication</li>
  <li>dealing with state control</li>
</ul><p>In one script! This code is then untestable. It&rsquo;s probably the best recipe for <em>spaghetti</em> there is. Imagine this in a bigger application with a fancy UI! It would become totally uncontrollable.</p><h2>Let&rsquo;s see the H-Ubu way to achieve the same thing</h2>
<ul>
  <li>We define a backend component to deal with the server, which publishes a service.</li>
  <li>We define a frontend component that uses the backend service to modify the HTML page.</li>
  <li>We define our application by registering these two components, configuring them and letting H-Ubu bind them.</li>
</ul><p>The clear advantages are:</p>
<ul>
  <li>The code is modular, and without visibility issues. Only the public contract is accessible from the frontend.</li>
  <li>The configuration allows us to give #ids and .classes into components and avoid coupling the JavaScript code to the page DOM.</li>
  <li>Components are testable.</li>
</ul><h2>The Application Composition</h2><p>The first thing to do, is to compose the application:</p>
<pre><code>&lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot;&gt;
    &lt;title&gt;H-Ubu Demo&lt;/title&gt;

        &lt;script src=&quot;http://code.jquery.com/jquery-latest.js&quot;&gt; &lt;/script&gt;
        &lt;!-- (1) --&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;hubu-all.js&quot;&gt;&lt;/script&gt;
        &lt;!-- (2) --&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;backendComponent.js&quot;&gt;&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;frontendComponent.js&quot;&gt;&lt;/script&gt;

        &lt;!-- The contracts --&gt;
        &lt;script type=&quot;text/javascript&quot; src=&quot;UserServiceContract.js&quot;&gt;&lt;/script&gt;

       &lt;script type=&quot;text/javascript&quot;&gt;
        &lt;!-- (3) --&gt;
        $(document).ready(function(){
            // Component registrations
            &lt;!-- (4) --&gt;
            hub
                .registerComponent(backendComponent, {
                    component_name: &#39;user&#39;
                })
                .registerComponent(frontendComponent, {
                    loginId : &#39;#login&#39;,
                    logoutId : &#39;#logout&#39;,
                    statusId : &#39;#status&#39;,
                    component_name: &#39;frontend&#39;
                })
                &lt;!-- (5) --&gt;
                .start();
        });
        &lt;/script&gt;
&lt;/head&gt;
</code></pre><p>First we import H-Ubu (1). jQuery is also imported (being a component dependency) (we can use any JavaScript library), and finally so are our components (2) and the contract. This contract is implemented by the backend component, and required by the frontend component.</p><p>When the page is loaded (3), we register our components (4) on a special H-Ubu object: <tt>hub</tt>. This is the <strong>central nervous system</strong> of the application.</p><p>As you can see, components are registered with configurations. The <code>component_name</code> is a specific property to name your component. The frontend component also receives the HTML ids to manipulate the page indirectly.</p><p>Finally we start the hub (5), i.e. the application.</p><p>How is the binding between components done? Let&rsquo;s see how components are developped.</p><h2>The User Service Contract</h2><p>The components interact using a <em>contract</em>. This contract is a simple JavaScript object, generally containing only <em>body-less</em> functions. This specifies what can be used from the component and how it can be used. For our simple application, the contract is the following:</p>
<pre><code>/**
 * User Service Contract definition.
 * The implementations are empty,
 * like a Java interface.
 */
var UserServiceContract = {
    /**
     * Checks if the user is logged in.
     */
    isLoggedIn : function() { },

    /**
     * Get the logged-in user.
     */
    getUser : function() { },

    /**
     * Ask to log in.
     * This method simulates an async call
     * and so returns immediately.
     * @param {String} name
     */
    login: function(name) { },

    /**
     * Ask to log out.
     * This method simulates an async call.
     * and so returns immediately.
     */
    logout: function() { }
}
</code></pre><h2>Backend component</h2><p>The backend component simulates a user login. It publishes the <em>UserServiceContract</em>, and so implements it.</p><p>Although we recommend using the JavaScript module pattern, we use a simple JavaScript object here for simplicity&rsquo;s sake. Don&rsquo;t forget that H-Ubu will deal with the visibility issue, so other components can only access the contract part.</p>
<pre><code>       var backendComponent = {

           hub: null,
           isUserLoggedIn: false,
           user: null,

           // First we are a component, so we need to implement the 4 methods required to be a valid component:

           /**
            * Method returning the component &lt;b&gt;unique&lt;/b&gt;
            * name. Using a fully qualified name is encouraged.
            * @return the component unique name
            */
           getComponentName: function() {
               return &#39;backend-component&#39;;
           },

           /**
            * Configure method. This method is called when the
            * component is registered on the hub.
            * @param theHub the hub
            */
           configure: function(theHub) {
               this.hub = theHub;
          // We provide the UserContractService:
          this.hub.provideService({
              component: this,
              contract: UserServiceContract
          });
           },

           /**
            * The Start function
            * This method is called when the hub starts or just
            * after configure if the hub is already started.
            */
           start: function() {},

           /**
            * The Stop method is called when the hub stops or
            * just after the component removal if the hub is 
            * not stopped. No events can be send in this method.
            */
           stop: function() {},

           // Now the UserServiceContract implementation:

           /**
            * Checks if the user is logged in.
            */
           isLoggedIn: function() {
               return this.isUserLoggedIn;
           },

           /**
            * Get the logged user.
            */
           getUser: function() {
               return this.user;
           },

           /**
            * Ask to log in.
            * This method simulates an async call
            * and so returns immediately.
            * @param {String} name
            */
           login: function(name) {
          // Because setTimeout calls the method on the global object (window),
          // we use a closure.
          var self = this;
               setTimeout(function() { self.loggedIn(name); }, 2000);
               return;
           },

           /**
            * Ask to log out.
            * This method simulates an async call,
            * and so returns immediately.
            */
           logout: function() {
          var self = this;
               setTimeout(function() { self.loggedOut(); }, 1000);
               return;
           },


           // We have two internal/private methods sending events

           /**
           * This method is called 2 seconds after the login request.
           * It&#39;s used to inform the hub that the login was successful.
           */
           loggedIn: function(name) {
               this.isLoggedIn = true;
               this.user = name;
               // We send an event notifying other components that we&#39;re logged in.
               this.hub.publish(this, &quot;/user/login&quot;, {
                   loggedIn: true
               });
           },

           loggedOut: function() {
               this.isLoggedIn = false;
               this.user = null;
               // We send an event notifying other components that we&#39;re logged out.
               this.hub.publish(this, &quot;/user/login&quot;, {
                   loggedIn: false
               });
           },
       }
</code></pre><p>As it&rsquo;s a component, it must implement the 4 methods required to be a valid component:</p>
<ul>
  <li>configure: receives the external configuration, declares the required and provided services</li>
  <li>start: the component is started, and so can start do stuff</li>
  <li>stop: the component is stopped</li>
  <li>getComponentName: returns the name of the component</li>
</ul><p>In the <em>configure</em> method, we declare that we&rsquo;re providing the <em>UserServiceContract</em> service.</p><p>Then the component implements the <em>UserServiceContract</em>. To simulate an Ajax call, the application uses &lsquo;setTimeout&rsquo;. When the function is really invoked, it sends an event (<code>hub.sendEvent(component, {loggedIn : false});</code>. Components registering a listener matching this event will automatically be called.</p><h2>Frontend component</h2><p>The backend component simulates server calls. The frontend component deals with the HTML page modification. To avoid being tied to one specific HTML page, the manipulated ids are passed inside the component configuration.</p>
<pre><code>var frontendComponent = {

    hub: null,

    /**
    * The login button id
    */
    loginId: null,

    /**
    * The logout button id
    */
    logoutId: null,

    /**
    * The status message id
    */
    statusId: null,

    /**
    * The user service
    */
    userService: null,

    //*********************//
    // Component Interface //
    //*********************//
    /**
    * Method returning the component&#39;s &lt;b&gt;unique&lt;/b&gt;
    * name. Using a fully qualified name is encouraged.
    * @return the component unique name
    */
    getComponentName: function() {
        return &#39;frontend-component&#39;;
    },

    /**
    * Configure method. This method is called when the
    * component is registered on the hub.
    * @param theHub the hub
    * @param configuration the configuration
    */
    configure: function(theHub, configuration) {
        this.hub = theHub;

        // Configuration
        this.loginId = configuration.loginId;
        this.logoutId = configuration.logoutId;
        this.statusId = configuration.statusId;

        // We require the UserServiceContract, it will be injected in the &#39;userService&#39; field.
        this.hub.requireService({
            component: this,
            contract: UserServiceContract,
            field: &quot;userService&quot;
        });

    },

    /**
    * The Start function
    * This method is called when the hub starts or just
    * after configure if the hub is already started.
    */
    start: function() {
        // The first thing to do is to get the user service and ask if we&#39;re
        // logged in
       console.dir(this.userService);
        var state = this.userService.isLoggedIn();

        this.updateStatus(state);

        // Then, we register a listener
        this.hub.subscribe(this, &quot;/user/login&quot;, this.callback);

        // Finally, we bind on the click event
       svc = this.userService;
        $(this.loginId).click(function() {
            svc.login(&#39;bla&#39;);
        });

        $(this.logoutId).click(function() {
            svc.logout();
        });
    },

    /**
    * The Stop method is called when the hub stops or
    * just after the component removal if the hub is 
    * not stopped. No events can be sent in this method.
    */
    stop: function() {

        },

    /**
    * Function called when we receive an event
    */
    callback: function(event) {
        console.log(&quot;receive an event &quot; + event.topic + &quot; - &quot; + event.loggedIn);
        this.updateStatus(event.loggedIn);
    },

    updateStatus: function(logged) {
        if (logged) {
            $(this.statusId).html(&#39;We are logged in&#39;).css(&#39;color&#39;, &#39;green&#39;);
        } else {
            $(this.statusId).html(&#39;We are not logged in&#39;).css(&#39;color&#39;, &#39;red&#39;);
        }
    }

}
</code></pre><p>The component code is structured like the backend component. However, the configure method receives the configuration and the HTML ids are retrieved from the configuration object. We also declare a required service injected within the <code>userServiceContract</code> field.</p><p>In the start function, the component registers a listener by giving a &lsquo;match&rsquo; method and a &lsquo;callback&rsquo; method. The match method is called to check if the component is interested in the event. If this method returns <code>true</code>, the &lsquo;callback&rsquo; method is invoked. It also directly uses the service to initiate the state. The method uses jQuery to set a handler on the button. To register the handler, it uses the ids given in the configuration.</p><p>When the login is completed, the &lsquo;callback&rsquo; method is called (thanks to the listener), and the status message is updated.</p><h1>Results</h1><p>Ok, it&rsquo;s a simple application. But it has shown how you can modularize your application with components, bind them using services and use the event mechanism.</p>
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2013
                        <a href="http://ow2.org">OW2</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
