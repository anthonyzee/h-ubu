<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Oct 25, 2012
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nano-project :: h-ubu</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

          
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="stylesheet" type="text/css" href="./css/site.css"/>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="stylesheet" type="text/css" href="./css/font-awesome.css"/>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript">var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-1518442-11']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();</script>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript">$(document).ready(function () {
                $("pre code").parent().addClass("prettyprint");
                prettyPrint();
                });</script>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="shortcut icon" href="favicon.png"/>
          
    <meta name="Date-Revision-yyyymmdd" content="20121025" />
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/nano-project/h-ubu">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 100;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="#" id="bannerLeft">
                                                                                                <img src="h-ubu-small.png"  alt="h-ubu - JavaScript Componentization"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2012-10-25</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.0.1-SNAPSHOT</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3>H-UBU</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="motivations.html" title="Motivations and Concepts">Motivations and Concepts</a>
            </li>
                  <li class="none">
                          <a href="quickstart.html" title="Quickstart">Quickstart</a>
            </li>
                  <li class="none">
                          <a href="external-resources.html" title="Resources">Resources</a>
            </li>
          </ul>
                        <h3>User Guide</h3>
                  <ul>
                  <li class="none">
                          <a href="creating-and-registering-components.html" title="Creating and Registering Components">Creating and Registering Components</a>
            </li>
                  <li class="none">
                          <a href="providing-services.html" title="Providing Services">Providing Services</a>
            </li>
                  <li class="none">
                          <a href="requiring-services.html" title="Requiring Services">Requiring Services</a>
            </li>
                  <li class="none">
                          <a href="direct-injection.html" title="Direct Injection">Direct Injection</a>
            </li>
                  <li class="none">
                          <a href="receiving-and-sending-events.html" title="Receiving and Sending Events">Receiving and Sending Events</a>
            </li>
                  <li class="none">
                          <a href="testing-components.html" title="Testing Components">Testing Components</a>
            </li>
          </ul>
                        <h3>Advanced Topics</h3>
                  <ul>
                  <li class="none">
                          <a href="using-requirejs.html" title="Using require.js">Using require.js</a>
            </li>
                  <li class="none">
                          <a href="using-nodejs.html" title="Using h-ubu in node.js">Using h-ubu in node.js</a>
            </li>
                  <li class="none">
                          <a href="contract.html" title="Contract and Conformity">Contract and Conformity</a>
            </li>
                  <li class="none">
                          <a href="service-orientation.html" title="Service-Orientation">Service-Orientation</a>
            </li>
                  <li class="none">
                          <a href="developper-guide.html" title="Developer Guide">Developer Guide</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                            <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="http://nano-project.github.com/h-ubu" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="https://github.com/nano-project/h-ubu" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>H-Ubu User Guide</h1>

<h2>Component Registration and Configuration</h2>

<p>Components must be registered on the hub to be managed. This is done simply by calling
<code>hub.registerComponent(theComponent, theConfiguration)</code>. This method takes the component as the first parameter
(mandatory) and the configuration as the second parameter.</p>

<p>The <em>conformity</em> of the component to the <code>AbstractComponent</code> contract is immediately checked. Invalid components will be
rejected (exception).</p>

<p>Components can be registered only once for a given name. By default, the name is the value returned by the
<code>getComponentName</code> methods. However, this is customizable by using the <code>component_name</code> property in the instance configuration.</p>

<p>The <code>configuration</code> parameter is optional. If specified, the configuration is injected as a parameter of the configure
method. Configurations are just an object containing key/value pairs. As said previously, the <code>component_name</code> property
is managed in a different way. When specified, the <code>getComponentName</code> method is replaced to return the given value.</p>

<p>It is recommended to use the configuration to pass any external data like HTML element selectors (ids, classes ...) to the component.</p>

<p><strong>Chaining</strong></p>

<p>The <code>registerComponent</code> function returns the hub object, allowing chaining.</p>

<h2>Bindings</h2>

<p>Components can receive references to other components. All components must already be plugged into the hub. If not,
the binding is rejected. Bindings are declared using the <code>hub.bind(binding)</code> method. The <code>binding</code> parameter is an object
describing the binding. This object must contain:</p>

<ul>
<li><code>component</code> : the name or the object reference of the component to be injected</li>
<li><code>to</code> : the name or the object reference of the component receiving the component</li>
<li><code>into</code> : the injection mechanism. it can be either a function pointer (called with the component as parameter),
or a String. In this latter case, to.into is injected. If to.into is a function, this function is called; if it's an
object, it is just injected (assigned).</li>
</ul>

<p>Moreover, it is strongly recommended to also set:</p>

<ul>
<li><code>contract</code> : the contract followed by the binding. The component must conform to this contract.</li>
</ul>

<p>If the contract is specified, H-Ubu injects a <strong>proxy</strong>. This ensures that it uses the contract only. This behavior can
be disabled by adding <code>proxy:false</code> to the binding parameter. Then all the public members of the component are accessible.
This is also the case when no contract is defined.</p>

<h2>Sending and receiving events without topics</h2>

<p>Components can also interact asynchronously using events. Events are simple key/value objects. They can follow a
contract but this is not enforced by H-Ubu. There are two ways to send / receive events in H-Ubu:</p>

<ul>
<li>the old / pure way using sendEvent and listeners</li>
<li>a MOM-like way based on topics</li>
</ul>

<p>To send an event, a component can just call:</p>

<pre><code>hub.sendEvent(theComponent, theEvent);
</code></pre>

<p><code>theComponent</code> is a reference to the component sending the event. <code>theEvent</code> is a JavaScript object.</p>

<p>Event reception is a multi-step process. First, the component must register a listener by using</p>

<pre><code>hub.registerListener(theComponent, theMatchMethod, theCallbackMethod)
</code></pre>

<p><code>theComponent</code> is a reference to the component which wants to receive the event. <code>theMatchMethod</code> is a function (can be
a pointer) defining the events to receive. <code>theCallbackMethod</code> is a function (can be a pointer) receiving the event.</p>

<p>So, when an event is sent, the match methods from all listeners are called to check if the event needs to be delivered
to the listener. The match method must return true or false:</p>

<pre><code>function match1(event) {
     return true; // Accept all events
}

function match2(event) {
    // Accept only event matching the contract
    return HUBU.UTILS.isObjectConformToContract(contract);
}

function match3(event) {
    // Accept events coming from aComponent
    return event.source == aComponent;
}

function match4(event) {
    // Accept events coming from a component named 'c'
    return event.source.getComponentName() == 'c';
}

function match5(event) {
    // Accept events containing 'logged = true'
    return event.logged != null  &amp;&amp; event.logged;
}
</code></pre>

<p>When a match method returns <code>true</code>, H-Ubu calls the associated callback method. Note that a component cannot receive
its own sent events.</p>

<p><strong>Event Source</strong></p>

<p>H-Ubu adds to all events a property called <code>source</code> referencing the component sending the event.</p>

<p><strong>Event Cloning</strong></p>

<p>To prevent listeners from modifying events, the match and callback methods receive a clone of the event.</p>

<h2>Summary</h2>

<ul>
<li>components register a listener on the hub and pass the match and callback methods</li>
<li>components send events to the hub</li>
<li>H-Ubu calls the match methods</li>
<li>for all match methods accepting the event, H-Ubu calls the associated callback method</li>
</ul>

<h2>Sending events using topics</h2>

<p>H-Ubu supports topics too. Components can subscribe to topics and publish events in topics. The overall behavior is similar to the previous way.</p>

<ul>
<li>components subscribe on the hub and topic name (regexp) and callback method</li>
<li>components publish events to a topic</li>
<li>H-Ubu dispatches the event to matching subscribers, and calls the callback methods</li>
</ul>

<p>To publish an event, a component must use:</p>

<pre><code>hub.publish(component, topic, event);
</code></pre>

<p>where <code>component</code> is a reference to itself, <code>topic</code> is the topic name (String) and <code>event</code> is the event (Object).</p>

<p>To subscribe to a topic, a component uses:</p>

<pre><code>hub.subscribe(component, topic, callback);
hub.subscribe(component, topic, callback, filter);
</code></pre>

<p>where <code>component</code> is a reference to itself, <code>topic</code> is a regular expression (String) on the topic name (this can just be
the topic name), and <code>callback</code> is the method called on the component (with the event as a parameter).</p>

<p>The second method adds a <code>filter</code> parameter. This parameter is a function to filter the event. Only events sent to the
correct topic and passing the filter function will be sent to the callback. The filter function must return either true or false.</p>

<pre><code>// Subscription to the /foo/bar topic
hub.subscribe(this, "/foo/bar", callback);

// Subscription to the /foo/* topic (all sub-topics)
hub.subscribe(this, "/foo/(.)*?", callback);

// Subscription with a filter
hub.subscribe(this, "/foo/bar", callback, function(event) {
    return event.x == y;
});

// Publication
hub.publish(this, "/foo/bar", {x : y};
</code></pre>

<p>This mechanism is based on the previous one, so has the same characteristics:</p>

<ul>
<li>event cloning</li>
<li>event source</li>
</ul>

<p>Moreover, the <code>event.topic</code> property is added to the event.</p>

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2012
                        <a href="http://www.arrow-group.eu/">Arrow-Group</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
