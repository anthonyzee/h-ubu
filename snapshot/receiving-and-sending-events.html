<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Jul 30, 2012
 | Rendered using Apache Maven Fluido Skin 1.2.2
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

          
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="stylesheet" type="text/css" href="./css/site.css"/>
      
                
        <?xml version="1.0" encoding="UTF-8"?>
<link rel="stylesheet" type="text/css" href="./css/font-awesome.css"/>
          
    <meta name="Date-Revision-yyyymmdd" content="20120730" />
    <meta http-equiv="Content-Language" content="en" />
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/nano-project/h-ubu">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 100;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://arrow-group.eu" id="bannerLeft">
                                                                                        <img src="http://www.arrow-group.eu/templates/default/medias/arrowgroup.gif"  alt="h-ubu - JavaScript Componentization"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2012-07-30</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.0.1-SNAPSHOT</li>
                      
                
            
      
                            </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
            
                                    <h3>H-UBU</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Home">Home</a>
            </li>
                  <li class="none">
                          <a href="motivations.html" title="Motivations and Concepts">Motivations and Concepts</a>
            </li>
                  <li class="none">
                          <a href="quickstart.html" title="Quickstart">Quickstart</a>
            </li>
          </ul>
                        <h3>User Guide</h3>
                  <ul>
                  <li class="none">
                          <a href="creating-and-registering-components.html" title="Creating and Registering Components">Creating and Registering Components</a>
            </li>
                  <li class="none">
                          <a href="providing-services.html" title="Providing Services">Providing Services</a>
            </li>
                  <li class="none">
                          <a href="requiring-services.html" title="Requiring Services">Requiring Services</a>
            </li>
                  <li class="none">
                          <a href="direct-injection.html" title="Direct Injection">Direct Injection</a>
            </li>
                  <li class="none">
            <strong>Receiving and Sending Events</strong>
          </li>
                  <li class="none">
                          <a href="testing-components.html" title="Testing Components">Testing Components</a>
            </li>
          </ul>
                        <h3>Advanced Topics</h3>
                  <ul>
                  <li class="none">
                          <a href="using-requirejs.html" title="Using require.js">Using require.js</a>
            </li>
                  <li class="none">
                          <a href="using-nodejs.html" title="Using h-ubu in node.js">Using h-ubu in node.js</a>
            </li>
                  <li class="none">
                          <a href="contract.html" title="Contract and Conformity">Contract and Conformity</a>
            </li>
                  <li class="none">
                          <a href="service-orientation.html" title="Service-Orientation">Service-Orientation</a>
            </li>
                  <li class="none">
                          <a href="developper-guide.html" title="Developer Guide">Developer Guide</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                      <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="$sitesearchValue" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="https://github.com/nano-project/h-ubu" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Sending and Receiving Events</h1>

<p>H-Ubu also allows components to interact using events.  Events are simple key/value objects. They can follow a contract but
this is not enforced by H-Ubu. </p>

<h2>Sending events using topics</h2>

<p>H-Ubu's eventing system is based on topics. Components can subscribe to topics and publish events on topics. </p>

<ul>
<li>components subscribe to a topic name (regular expression) and specify a callback method to be called when an event 
is sent on that topic</li>
<li>components publish events to a topic</li>
<li>H-Ubu dispatches the event to matching subscribers, and calls the callback methods</li>
</ul>

<p>To publish an event, a component must use:</p>

<pre><code>hub.publish(component, topic, event);
</code></pre>

<p>where <code>component</code> is a reference to itself, <code>topic</code> is the topic name (String) and <code>event</code> is the event (Object).</p>

<p>To subscribe to a topic, a component uses:</p>

<pre><code>hub.subscribe(component, topic, callback);
hub.subscribe(component, topic, callback, filter);
</code></pre>

<p>where <code>component</code> is a reference to itself, <code>topic</code> is a regular expression (String) on the topic name (this can just
be the topic name), and <code>callback</code> is the method called on the component (with the event as a parameter). The second
method adds a <code>filter</code> parameter. This parameter is a function to select events. Only events sent to the correct topic
<strong>and</strong> matching the filter function will be sent to the callback. The filter function must return either <code>true</code> or <code>false</code>.</p>

<pre><code>// Subscription to the /foo/bar topic
hub.subscribe(this, "/foo/bar", callback);

// Subscription to the /foo/* topic (all sub-topics)
hub.subscribe(this, "/foo/(.)*?", callback);

// Subscription with a filter
hub.subscribe(this, "/foo/bar", callback, function(event) {
    return event.x == y;
});

// Publication
hub.publish(this, "/foo/bar", {x : y};
</code></pre>

<p>The <code>event.topic</code> property is added to the event.</p>

<h2>Sending and receiving events without topics</h2>

<p>Components can interact using events without using topics. Even if this version looks a bit simpler, we recommend using
topics in order to benefit from a looser coupling:</p>

<p>To send an event, a component can just call:</p>

<pre><code>hub.sendEvent(theComponent, theEvent);
</code></pre>

<p><code>theComponent</code> is a reference to the component sending the event. <code>theEvent</code> is a JavaScript object.</p>

<p>Event reception is a multi-step process. First, the component must register a listener by using:</p>

<pre><code>hub.registerListener(theComponent, theMatchMethod, theCallbackMethod)
</code></pre>

<p><code>theComponent</code> is a reference to the component that wants to receive the event. <code>theMatchMethod</code> is a function (can be
a pointer) defining the events to receive. <code>theCallbackMethod</code> is a function (can be a pointer) receiving the event.</p>

<p>So, when an event is sent, the match methods from all listeners are called to check if the event needs to be delivered
to the listener. The match method must return true or false:</p>

<pre><code>function match1(event) {
     return true; // Accept all events
}

function match2(event) {
    // Accept only events matching the contract
    return HUBU.UTILS.isObjectConformToContract(contract);
}

function match3(event) {
    // Accept events coming from aComponent
    return event.source == aComponent;
}

function match4(event) {
    // Accept events coming from a component named 'c'
    return event.source.getComponentName() == 'c';
}

function match5(event) {
    // Accept events containing 'logged = true'
    return event.logged != null &amp;&amp; event.logged;
}
</code></pre>

<p>When a match method returns <code>true</code>, H-Ubu calls the associated callback method. Note that a component cannot receive
events sent by itself.</p>

<h2>Event Source</h2>

<p>H-Ubu adds to all events a property called <code>source</code> referencing the component sending the event.</p>

<h2>Event Cloning</h2>

<p>To prevent listeners from modifying events, the match and callback methods receive a clone of the event.</p>

<h2>Summary</h2>

<ul>
<li>components register a listener on the hub and pass the match and callback methods</li>
<li>components send events to the hub</li>
<li>H-Ubu calls the match methods</li>
<li>For all match methods accepting the event, H-Ubu calls the associated callback method</li>
</ul>

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2012
                        <a href="http://www.arrow-group.eu/">Arrow-Group</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
